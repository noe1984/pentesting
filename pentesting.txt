-----VIRTUAL MACHINES
Virtual box
-Kali Linux
-Metasploitable
    https://sourceforge.net/projects/metasploitable/
    Linux 2.3/3.x/4.x(64-bit)
    1024mb
    use an existing 
    choose metasploitable

    settings> system > processor enable PAE/NX 
-Windows 10 
VirtualBox> file> import appliance: choose windows image



-----TCP/IP MODEL
Aplication
Trasport
Internet
Link


-----ROUTING - Installin Debian in virtual box

-Router 1
    name: Router1
    512 mb 
    create virtual hard disk now 
    vdi
    dinamically allocated
    8gb

-configuration
    system > processor: enable PAE/NX
    storage: load debian image

-start
    not select desktop environment
    select ssh server
    power off machine 

-configuration
    network > adapter 1 > internal network
        name: internal-10
    network > adapter 2 > internal network
        name: internal-100

ls /sys/class/net/          check the network interfaces tha are cofigured

-nano /etc/network/interfaces
    auto enp0s3
    iface enp0s3 inet static
        address 192.168.10.254
        netmask 255.255.255.0

    auto enp0s8
    iface enp0s8 inet static
        address 192.168.100.1
        netmask 255.255.255.0
        ctrl x to exit

    cat /etc/network/interfaces     check the modified file
    shutdown -h now                 shutdown the virtual machine
    restart machine


-----CLONING MACHINE - 2nd ROUTER 

-Router 2
    name it Router2 and check the reset mac address box
    linked clone

    network > adapter1
        change internal-10 for 100
    network > adapter2 
        change internal-100 for 20
    start
    login as root user

nano /etc/network/interfaces
    auto enp0s3
    iface enp0s3 inet static
        address 192.168.100.2
        netmask 255.255.255.0

    auto enp0s8
    iface enp0s8 inet static
        address 192.168.20.254
        netmask 255.255.255.0
        ctrl x to exit

nano /etc/hosts
    change the hostname to Router2 
nano /etc/hostname 
    change the hostname to Router2 
reboot 

-start the original router
-in Router2 
    ping 192.168.100.2  okk
    ping 192.168.10.254 no connectivity yet 



-----CONFIGURING ROUTES     KALI>>> ROUTER1 --- ROUTER2 <<< METASPLOITABLE

-Connect the Kali machine to the Metasploitable machine through the 2 routers

-Kali machine > configuration > network >adapter1
    Internal network
        name: internal 10

-Metasploitable machine > configuration > network > adapter1
    Internal network
        name: internal 20

start both machines
ip route show           it show the routes configured

-In Router1 
    ip route add 192.168.20.0/24 via 192.168.100.2 dev enp0s8
-In Router2
    ip route add 192.168.10.0/24 via 192.168.100.1 dev enp0s3

-start kali machine 
edit connections > ipv4 > manual
    address 192.168.10.10       segment ip address
    netmask 255.255.255.0       24 mask
    gateway 192.168.10.254      this was configured for router #1
save and restart ethernet connection

Kali termninal
    ifconfig
    ping 192.168.10.254         connection to the router1
    ping 192.168.100.2          *no connectivity yet


-Active packet routing
Router1
    nano /proc/sys/net/ipv4/ip_forward
        change 0 for 1
Router2
    nano /proc/sys/net/ipv4/ip_forward
        change 0 for 1

    ping 192.168.100.2          *there is connectivity now


-Metasploitable
    login with: msfadmin, and password: msfmadmin
    sudo su 
-nano /etc/network/interfaces
    auto eth0
    iface eth0 inet static
        address 192.168.20.34
        netmask 255.255.255.0
        network 192.168.20.0
        broadcast 192.168.20.255
        gateway 192.168.20.254

reboot 
ping 192.168.10.10      check connection to kali machine 

*******
To make the route permanent, you'll need to add it to the network configuration file, 
    with the "up" parameter preceding it, like so:

up ip route add 192.168.20.0/24 via 192.168.100.2 dev enp0s8

To make routing permanent, you must edit the /etc/sysctl.conf file and add the line:

net.ipv4.ip_forward = 1

In many cases this line may already exist in the file and you only need to remove the comment identifier (#).

                                    
                                    
            ------------P E N T E S T I N G-----------------
RECOGNITION

-------WHOIS 
Is a request/response-based TCP protocol for querying a database to determine the owner of a domain name or IP address on the Internet.

-Kali 
    settings > network > adapter1 >attached to 'NAT'
    or create a linked clone to modify the configuration without losing the first configuration

who is unam.mx
who is platzi.com


------NETCRAFT
offers market share analysis of web servers and hosting, including the detection of the type of web server and operating system.
Resources > site report


------HTTRACK
if not installed
    sudo apt install httrack 
clone a website
    create a directory: copy
    httrack www.somesite.com -O copy/

man httrack to see more flags


------RECON-NG
For version 5.1.1 of Recong-ng

install all modules
    marketplace install all

see the list of modules
    modules search

use a module (change the ending according to the name of the module you are going to use)
    modules load mymodule

view info
    info

define an option
    options set SOURCE somesite

execute
    run

return to modules
    back


------PROTOCOL ANALYSIS TCP AND UDP
UDP: Connectionless, used in streaming services for video and voice transmission.
TCP: Connection-oriented guarantees connectivity from one point to another, through the three-way handshake

-most common ports
20 FTP TRANSFER
21FTP
22 SSH
23 TELNET
25 SMTP
53 DNS
80HTTP
137-139 BIOS
443 HTTPS
445SMB
1433 MSSQL
3306 MySQL
3389 RDP
5800 VNC OVER HTTP
5900 NCV


------IP AND PORT SCANNING

-What is ICMP?
    To exchange status data or error messages, nodes use the 
    Internet Control Message Protocol (ICMP) on TCP/IP networks.

    Specifically, application servers and gateways such as routers 
    use this implementation of the IP protocol to return datagram problem 
    messages to the sender of the packet.

-man fping
fping -a -g 192.168.20.0/24                 configure the range of ip's to send ping packets
fping -a -g 192.168.20.0/24 > hosts.txt
    El parámetro -a: muestra los sistemas vivos
    El parámetro -g: genera una lista

    response 
    192.168.20.34 metasploitable machine
    192.168.20.254 router gateway 

nmap 192.168.20.34 
nmap -sP 192.168.20.*       scan hosts 

nmap -p- 192.168.20.34      scan all ports
nmap -p80 192.168.20.34     scan a specific port '80'


-Full stealth scan and only in controlled scenarios
nmap -sS -O -sV -v (target_address)     requires root permissions

    -sS : TCP SYN/connect()/ACK/Window/Maimon scans
    -O: Enable OS detection
    -sV : Poll open ports to determine service/version information
    -v : Increase verbosity level (use -vv for greater effect)

